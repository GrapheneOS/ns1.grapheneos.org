define public_ipv4 = 66.135.8.22;
define public_ipv6 = 2001:19f0:1000:c0d4:5400:05ff:fec1:7c21;
define bgp_password = "{{bgp_password}}";

filter grapheneos_ipv4_filter {
    # Cogent: set customer route local preference to 70 (below peers)
    bgp_community.add((174, 70));
    # Cogent: set localpref to 10 upon entering AF Region from other regions of the Cogent backbone
    bgp_community.add((174, 932));
    # Cogent: set localpref to 10 upon entering AU Region from other regions of the Cogent backbone
    bgp_community.add((174, 942));
    # Cogent: set localpref to 10 upon entering SA Region from other regions of the Cogent backbone
    bgp_community.add((174, 952));
    # Cogent: set localpref to 10 upon entering AP Region from other regions of the Cogent backbone
    bgp_community.add((174, 962));
    # Cogent: set localpref to 10 upon entering EU Region from other regions of the Cogent backbone
    bgp_community.add((174, 982));

    # Arelion: set localpref to 50 beyond the connected region
    bgp_community.add((1299, 10050));
    # Arelion: prepend 2x to all peers in Europe
    bgp_community.add((1299, 2002));
    # Arelion: prepend 2x to all peers in Asia & Pacific
    bgp_community.add((1299, 7002));

    # NTT: set localpref to 50 beyond the connected region
    bgp_community.add((2914, 436));
    # NTT: prepend 2x to all customers in Europe
    bgp_community.add((2914, 4212));
    # NTT: prepend 2x to all peers in Europe
    bgp_community.add((2914, 4222));
    # NTT: prepend 2x to all customers in Asia
    bgp_community.add((2914, 4412));
    # NTT: prepend 2x to all peers in Asia
    bgp_community.add((2914, 4422));
    # NTT: prepend 2x to all customers in South America
    bgp_community.add((2914, 4612));
    # NTT: prepend 2x to all peers in South America
    bgp_community.add((2914, 4622));

    # GTT: set localpref below peers
    bgp_community.add((3257, 1970));
    # GTT: prepend 2x in Europe
    bgp_community.add((3257, 2492));
    # GTT: prepend 2x in Asia
    bgp_community.add((3257, 2592));
    # GTT: prepend 2x in Africa
    bgp_community.add((3257, 2692));
    # GTT: prepend 2x in South America
    bgp_community.add((3257, 2892));

    # Lumen: set BGP Local Pref to 70 (less than peer routes)
    bgp_community.add((3356, 70));

    # PCCW: set localpref to 60 beyond the connected region
    bgp_community.add((3491, 51912));
    # PCCW: prepend 2x to all peers in Europe
    bgp_community.add((3491, 50302));
    # PCCW: prepend 2x to all peers in Asia
    bgp_community.add((3491, 50402));
    # PCCW: prepend 2x to all peers in Africa
    bgp_community.add((3491, 50502));
    # PCCW: prepend 2x to all peers in Australia
    bgp_community.add((3491, 50702));

    # Comcast: do not advertise to Orange
    #
    # without this, Orange sends traffic from France even with 4x Comcast prepends for it
    bgp_community.add((65100, 5511));

    # Vultr: do not advertise to Bharti
    bgp_large_community.add((20473, 6000, 9498));
    # NYIIX: do not advertise to Bharti
    bgp_large_community.add((13538, 0, 9498));

    # Vultr: do not advertise to China Mobile International
    bgp_large_community.add((20473, 6000, 58453));
    # NYIIX: do not advertise to China Mobile International
    bgp_large_community.add((13538, 0, 58453));

    # Vultr: do not advertise to Startrek Telecom
    bgp_large_community.add((20473, 6000, 139901));
    # NYIIX: do not advertise to Startrek Telecom
    bgp_large_community.add((13538, 0, 139901));

    accept;
};

filter grapheneos_ipv6_filter {
    # Cogent: set customer route local preference to 70 (below peers)
    bgp_community.add((174, 70));
    # Cogent: set localpref to 10 upon entering AF Region from other regions of the Cogent backbone
    bgp_community.add((174, 932));
    # Cogent: set localpref to 10 upon entering AU Region from other regions of the Cogent backbone
    bgp_community.add((174, 942));
    # Cogent: set localpref to 10 upon entering SA Region from other regions of the Cogent backbone
    bgp_community.add((174, 952));
    # Cogent: set localpref to 10 upon entering AP Region from other regions of the Cogent backbone
    bgp_community.add((174, 962));
    # Cogent: set localpref to 10 upon entering EU Region from other regions of the Cogent backbone
    bgp_community.add((174, 982));

    # Arelion: set localpref to 50 beyond the connected region
    bgp_community.add((1299, 10050));
    # Arelion: prepend 2x to all peers in Europe
    bgp_community.add((1299, 2002));
    # Arelion: prepend 2x to all peers in Asia & Pacific
    bgp_community.add((1299, 7002));

    # NTT: set localpref to 50 beyond the connected region
    bgp_community.add((2914, 436));
    # NTT: prepend 2x to all customers in Europe
    bgp_community.add((2914, 4212));
    # NTT: prepend 2x to all peers in Europe
    bgp_community.add((2914, 4222));
    # NTT: prepend 2x to all customers in Asia
    bgp_community.add((2914, 4412));
    # NTT: prepend 2x to all peers in Asia
    bgp_community.add((2914, 4422));
    # NTT: prepend 2x to all customers in South America
    bgp_community.add((2914, 4612));
    # NTT: prepend 2x to all peers in South America
    bgp_community.add((2914, 4622));

    # GTT: set localpref below peers
    bgp_community.add((3257, 1970));
    # GTT: prepend 2x in Europe
    bgp_community.add((3257, 2492));
    # GTT: prepend 2x in Asia
    bgp_community.add((3257, 2592));
    # GTT: prepend 2x in Africa
    bgp_community.add((3257, 2692));
    # GTT: prepend 2x in South America
    bgp_community.add((3257, 2892));

    # Lumen: set BGP Local Pref to 70 (less than peer routes)
    bgp_community.add((3356, 70));

    # PCCW: set localpref to 60 beyond the connected region
    bgp_community.add((3491, 51912));
    # PCCW: prepend 2x to all peers in Europe
    bgp_community.add((3491, 50302));
    # PCCW: prepend 2x to all peers in Asia
    bgp_community.add((3491, 50402));
    # PCCW: prepend 2x to all peers in Africa
    bgp_community.add((3491, 50502));
    # PCCW: prepend 2x to all peers in Australia
    bgp_community.add((3491, 50702));

    # Comcast: do not advertise to Orange
    #
    # without this, Orange sends traffic from France even with 4x Comcast prepends for it
    bgp_community.add((65100, 5511));

    # Vultr: do not advertise to Bharti
    bgp_large_community.add((20473, 6000, 9498));
    # NYIIX: do not advertise to Bharti
    bgp_large_community.add((13538, 0, 9498));

    # Vultr: do not advertise to China Mobile International
    bgp_large_community.add((20473, 6000, 58453));
    # NYIIX: do not advertise to China Mobile International
    bgp_large_community.add((13538, 0, 58453));

    # Vultr: do not advertise to Startrek Telecom
    bgp_large_community.add((20473, 6000, 139901));
    # NYIIX: do not advertise to Startrek Telecom
    bgp_large_community.add((13538, 0, 139901));

    accept;
};
