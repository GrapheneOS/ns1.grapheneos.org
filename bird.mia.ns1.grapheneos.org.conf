define public_ipv4 = 45.32.173.220;
define public_ipv6 = 2001:19f0:9002:2981:5400:05ff:fec1:65c4;
define bgp_password = "{{bgp_password}}";

filter grapheneos_ipv4_filter {
    if proto = "grapheneos_ipv4_route" then {
        # Cogent: set customer route local preference to 70 (below peers)
        bgp_community.add((174, 70));
        # Cogent: set localpref to 10 upon entering AF Region from other regions of the Cogent backbone
        bgp_community.add((174, 932));
        # Cogent: set localpref to 10 upon entering AU Region from other regions of the Cogent backbone
        bgp_community.add((174, 942));
        # Cogent: set localpref to 10 upon entering AP Region from other regions of the Cogent backbone
        bgp_community.add((174, 962));
        # Cogent: set localpref to 10 upon entering EU Region from other regions of the Cogent backbone
        bgp_community.add((174, 982));

        # Arelion: set localpref to 50 within EU
        bgp_community.add((1299, 12050));
        # Arelion: set localpref to 50 within AP
        bgp_community.add((1299, 17050));
        # Arelion: prepend 2x to all peers in Europe
        bgp_community.add((1299, 2002));
        # Arelion: prepend 2x to all peers in Asia & Pacific
        bgp_community.add((1299, 7002));

        # NTT: set localpref to 50 within EU
        bgp_community.add((65530, 3200));
        # NTT: set localpref to 50 within AS
        bgp_community.add((65530, 3400));
        # NTT: prepend 2x to all customers in Europe
        bgp_community.add((2914, 4212));
        # NTT: prepend 2x to all peers in Europe
        bgp_community.add((2914, 4222));
        # NTT: prepend 2x to all customers in Asia
        bgp_community.add((2914, 4412));
        # NTT: prepend 2x to all peers in Asia
        bgp_community.add((2914, 4422));

        # Vultr: do not advertise to GTT
        bgp_large_community.add((20473, 6000, 3257));
        # GTT: prepend 2x in Europe (only applies to EU regional peers)
        bgp_community.add((3257, 2492));
        # GTT: prepend 2x in Asia (only applies to Asia regional peers)
        bgp_community.add((3257, 2592));

        # Lumen: set BGP Local Pref to 70 (less than peer routes)
        bgp_community.add((3356, 70));

        # PCCW: set localpref to 60 beyond the connected region
        bgp_community.add((3491, 51912));
        # PCCW: prepend 2x to all peers in Europe
        bgp_community.add((3491, 50302));
        # PCCW: prepend 2x to all peers in Asia
        bgp_community.add((3491, 50402));
        # PCCW: prepend 2x to all peers in Africa
        bgp_community.add((3491, 50502));
        # PCCW: prepend 2x to all peers in Australia
        bgp_community.add((3491, 50702));

        # Comcast: do not advertise to Orange
        #
        # without this, Orange sends traffic from France even with 4x Comcast prepends for it
        bgp_community.add((65100, 5511));

        # FL-IX: do not advertise to Swisscom
        #
        # without this, Swisscom sends traffic from Switzerland
        bgp_large_community.add((63221, 0, 3303));

        # Vultr: do not advertise to Bharti
        bgp_large_community.add((20473, 6000, 9498));

        # Vultr: do not advertise to Startrek Telecom
        bgp_large_community.add((20473, 6000, 139901));

        accept;
    }
    reject;
};

filter grapheneos_ipv6_filter {
    if proto = "grapheneos_ipv6_route" then {
        # Cogent: set customer route local preference to 70 (below peers)
        bgp_community.add((174, 70));
        # Cogent: set localpref to 10 upon entering AF Region from other regions of the Cogent backbone
        bgp_community.add((174, 932));
        # Cogent: set localpref to 10 upon entering AU Region from other regions of the Cogent backbone
        bgp_community.add((174, 942));
        # Cogent: set localpref to 10 upon entering AP Region from other regions of the Cogent backbone
        bgp_community.add((174, 962));
        # Cogent: set localpref to 10 upon entering EU Region from other regions of the Cogent backbone
        bgp_community.add((174, 982));

        # Arelion: set localpref to 50 within EU
        bgp_community.add((1299, 12050));
        # Arelion: set localpref to 50 within AP
        bgp_community.add((1299, 17050));
        # Arelion: prepend 2x to all peers in Europe
        bgp_community.add((1299, 2002));
        # Arelion: prepend 2x to all peers in Asia & Pacific
        bgp_community.add((1299, 7002));

        # NTT: set localpref to 50 within EU
        bgp_community.add((65530, 3200));
        # NTT: set localpref to 50 within AS
        bgp_community.add((65530, 3400));
        # NTT: prepend 2x to all customers in Europe
        bgp_community.add((2914, 4212));
        # NTT: prepend 2x to all peers in Europe
        bgp_community.add((2914, 4222));
        # NTT: prepend 2x to all customers in Asia
        bgp_community.add((2914, 4412));
        # NTT: prepend 2x to all peers in Asia
        bgp_community.add((2914, 4422));

        # Vultr: do not advertise to GTT
        bgp_large_community.add((20473, 6000, 3257));
        # GTT: prepend 2x in Europe (only applies to EU regional peers)
        bgp_community.add((3257, 2492));
        # GTT: prepend 2x in Asia (only applies to Asia regional peers)
        bgp_community.add((3257, 2592));

        # FL-IX: do not advertise to Swisscom
        #
        # without this, Swisscom sends traffic from Switzerland
        bgp_large_community.add((63221, 0, 3303));

        # Lumen: set BGP Local Pref to 70 (less than peer routes)
        bgp_community.add((3356, 70));

        # PCCW: set localpref to 60 beyond the connected region
        bgp_community.add((3491, 51912));
        # PCCW: prepend 2x to all peers in Europe
        bgp_community.add((3491, 50302));
        # PCCW: prepend 2x to all peers in Asia
        bgp_community.add((3491, 50402));
        # PCCW: prepend 2x to all peers in Africa
        bgp_community.add((3491, 50502));
        # PCCW: prepend 2x to all peers in Australia
        bgp_community.add((3491, 50702));

        # Comcast: do not advertise to Orange
        #
        # without this, Orange sends traffic from France even with 4x Comcast prepends for it
        bgp_community.add((65100, 5511));

        # Vultr: do not advertise to Bharti
        bgp_large_community.add((20473, 6000, 9498));

        # Vultr: do not advertise to Startrek Telecom
        bgp_large_community.add((20473, 6000, 139901));

        accept;
    }
    reject;
};
